{% extends "base.html" %}
{% block title %}学生サインアップ{% endblock %}
{% block messages %}{% endblock %}

{% block content %}

<section class="content">
    <h1 class="title">学生サインアップ</h1>

    <form method="POST">
        {% csrf_token %}

        <div class="signup-box">

            <!-- ヘッダー -->
            <div class="signup-header">
                <div class="signup-cell signup-wide">入学年度</div>
                <div class="signup-cell signup-wide">学科</div>
                <div class="signup-cell signup-wide">何年制</div>
                <div class="signup-cell signup-wide">ID</div>
                <div class="signup-cell signup-wide">パスワード</div>
                <div class="signup-cell signup-wide">番号</div>
                <div class="signup-cell signup-wide">名前</div>
                <div class="signup-cell signup-wide">削除</div>
            </div>

            <!-- 本体 -->
            <div class="signup-body" id="signup-body">

                <!-- ★ 1行目 -->
                <div class="signup-row">

                    <!-- 入学年度 -->
                    <div class="signup-cell signup-wide">
                        <input type="text" name="academic_year[]" value="{{ selected_academic_year }}"
                            placeholder="例: 2024" maxlength="4" required pattern="[0-9]{4}" title="4桁の半角数字で入力してください">
                    </div>

                    <!-- 学科 -->
                    <div class="signup-cell signup-wide">
                        <select name="department[]" class="signup-select-small" required>
                            <option value="">選択してください</option>
                            {% for c in class_list %}
                            <option value="{{ c.department }}" {% if c.is_selected %}selected{% endif %}>
                                {{ c.department }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- 何年制 -->
                    <div class="signup-cell signup-wide">
                        <select name="course_years[]" class="signup-select-small" required>
                            <option value="">選択してください</option>
                            {% for cy in course_years_list %}
                            <option value="{{ cy.value }}" {% if cy.is_selected %}selected{% endif %}>
                                {{ cy.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- 学生情報 -->
                    <div class="signup-cell signup-wide">
                        <input type="text" name="student_id[]" placeholder="ID" required pattern="[0-9]*"
                            title="半角数字で入力してください">
                    </div>

                    <div class="signup-cell signup-wide">
                        <input type="password" name="password[]" placeholder="パスワード" required>
                    </div>

                    <div class="signup-cell signup-wide">
                        <input type="text" name="number[]" placeholder="出席番号" required pattern="[0-9]*"
                            title="半角数字で入力してください">
                    </div>

                    <div class="signup-cell signup-wide">
                        <input type="text" name="fullname[]" placeholder="氏名" required>
                    </div>

                    <div class="signup-cell signup-wide"></div>
                </div>
            </div>
        </div>

        <!-- エラー -->
        <div class="signup-errors">
            {% if form.errors.department %}
            <div class="field-error-dept">選択してください。</div>
            {% endif %}

            {% if messages %}
            {% for message in messages %}
            <div style="color: #ff4d4f; font-weight: bold; margin-bottom: 5px;">{{ message }}</div>
            {% endfor %}
            {% endif %}
        </div>

        <!-- ボタン -->
        <div class="signup-buttons">
            <button type="button" onclick="location.href='{% url 'telles:class_signup' %}'">
                学科登録
            </button>

            <button type="button" onclick="addRow({{ is_year_only|yesno:'true,false' }})">
                + 行を追加
            </button>

            <button type="submit">登録する</button>
        </div>

    </form>
</section>
{% endblock %}